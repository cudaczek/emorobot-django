{% extends 'base.html' %}

<script>
    {% block jquery %}

        var endpoint = 'api/data/';
        var audio_labels = [];
        var video_labels = [];
        var video_data = [];
        var audio_data = [];
        $.ajax({
            method: "GET",
            url: endpoint,
            success: function (data) {
                audio_labels = data.audio_recognizer_labels;
                video_labels = data.video_recognizer_labels;
                video_data = data.video_data;
                audio_data = data.audio_data;
                setChart();
            },
            error: function (error_data) {
                console.log("error");
                console.log(error_data)
            }
        });

        function newDateString(days) {
            return moment().add(days, 'd').format();
        }

        function setChart() {

            var config = {
                type: 'line',
                data: {
                    yLabels: audio_labels.concat(video_labels),
                    datasets: [{
                        label: 'Audio recognition',
                        data: audio_data,
                        backgroundColor: false,
                        fill: false,
                    }, {
                        label: 'Video recognition',
                        data: video_data,
                        backgroundColor: false,
                        fill: false,
                    }]
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: 'Recognized emotions'
                    },
                    scales: {
                        xAxes: [{
                            type: 'time',
                            display: false,
                            scaleLabel: {
                                {#display: true,#}
                                labelString: 'Date'
                            },
                            ticks: {
                                source: 'data',
                                maxTicksLimit: 20,
                                {#autoSkip: true,#}
                                {#autoSkipPadding: 50#}
                            },
                            time: {
                                unit: 'minute',
                                unitStepSize: 0.5,
                                displayFormats: {
                                    'hour': 'HH:mm'
                                },
                            },


                        }],
                        yAxes: [{
                            type: 'category',
                            position: 'left',
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Emotion'
                            },
                            ticks: {
                                reverse: true
                            }
                        }]
                    }
                }
            };
            var ctx = document.getElementById('chart1').getContext('2d');
            var chart1 = new Chart(ctx, config);
        }


    {% endblock %}
</script>

{% block navbar %}
    <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="{% url 'index' %}">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'current_stats' %}">Current</a></li>
        <li class="nav-item active"><a class="nav-link" href="{% url 'preview' %}">Preview</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'control_panel' %}">Control Panel</a>
        </li>
    </ul>
{% endblock navbar %}

{% block content %}

    <div url-endpoint='{% url "preview_data" %}'>
        <h1>Preview recognized emotion</h1>
        <div>
            <canvas id="chart1" width="400" height="200"></canvas>
        </div>
    </div>


{% endblock content %}